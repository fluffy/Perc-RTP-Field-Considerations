<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">
<?rfc toc="yes"?>
<?rfc tocompact="yes"?>
<?rfc tocdepth="3"?>
<?rfc tocindent="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>
<rfc category="info" docName="draft-westerlund-perc-rtp-considerations-00"
     ipr="trust200902">
  <front>
    <title abbrev="Abbreviated-Title">Considerations of handling of RTP
    fields</title>

    <author fullname="Magnus Westerlund" initials="M." surname="Westerlund">
      <organization>Ericsson</organization>

      <address>
        <postal>
          <street>Farogatan 2</street>

          <city>SE-164 80 Stockholm</city>

          <country>Sweden</country>
        </postal>

        <phone>+46 10 714 82 87</phone>

        <email>magnus.westerlund@ericsson.com</email>
      </address>
    </author>

    <date day="14" month="October" year="2015" />

    <abstract>
      <t>This draft discusses how the Privacy Enhanced RTP Conferencing
      solution will need consider the different RTP header fields in regards
      to both hop-by-hop and end-to-end security.</t>
    </abstract>
  </front>

  <middle>
    <section title="Introduction">
      <t>In the design of the PERC end-to-end security solution for RTP media
      streams there is need to carefully consider what properties the
      different fields have, their security implications and provide
      recommendations for how they are handled. This review needs to consider
      both hop-by-hop properties as well as the end-to-end security.</t>

      <t>The fields analysed are that of a regular RTP packet. This is to
      consider the impact of the information that exists normally in an
      centralized multi-party conference.</t>

      <t>This document is a working document, and not intended to be published
      as an RFC.</t>
    </section>

    <section title="Definitions">
      <t>This document uses the following definitions:<list style="hanging">
          <t hangText="Endpoint:">An RTP stream sending and/or receiving
          entity that is part of the end-to-end security context.</t>

          <t hangText="MDD:">Media Delivery Device - An RTP middlebox that
          operates according to any of the three possible <xref
          target="I-D.ietf-avtcore-rtp-topologies-update">RTP
          topologies</xref> that is possible in the PERC system:<list
              style="empty">
              <t>Transport Translator - Relay</t>

              <t>Switching RTP Mixer</t>

              <t>Selective Forwarding Middlebox (SFM)</t>
            </list></t>

          <t hangText="Third Party:">An entity that is neither an endpoint nor
          an MDD.</t>
        </list></t>

      <t></t>

      <section title="Connection Case">
        <t>This analys is based on a basic connectivity use cases, where a
        media stream sending endpoint (originating) sends one or more RTP
        streams to a MDD. That MDD is in its turn connected to another MDD
        (Cascaded) which further sends the media (when selecting to) from the
        originating endpoint to the receiving endpoint. This connection case
        is depicted in <xref target="fig-connection-case"></xref>.</t>

        <figure anchor="fig-connection-case">
          <artwork><![CDATA[+-------------+     +------+     +------+     +-----------+
|             |     |      |     |      |     |           |
| Originating +---->+ MDD  +---->+ MDD  +---->+ Receiving |
| Endpoint    |     |      |     |      |     | Endpoint  |
|             |     |      |     |      |     |           |
+-------------+     +------+     +------+     +-----------+
]]></artwork>
        </figure>

        <t></t>
      </section>

      <section title="Additional Assumptions">
        <t>This document assumes that the originating media stream is
        identified by the SSRC value used by the originating endpoint. This
        SSRC value needs to be preserved to the receiving endpoint. It is
        assumed that even if SSRC/CSRC translation is in use by an MDD, there
        will exist an one to one mapping between originating SSRC value and
        the SSRC/CSRC value the receiving endpoint receives. Further for MDDs
        operating as Media Switching RTP mixers they will indicate the
        originating SSRC as CSRC when it switches that stream into one of the
        MDD's SSRCs. The CSRC will need to be maintained even over multiple
        MDDs.</t>
      </section>
    </section>

    <section title="RTP Packets Fields">
      <t>This section analyses each RTP packet field or part. The anlysis for
      each field should answer the following questions:<list style="empty">
          <t>Can it or needs to be modified on path by an MDD?</t>

          <t>Does the receiving endpoint need the originating endpoint's set
          value?</t>

          <t>Does it need end-to-end authentication?</t>

          <t>Does it need end-to-end confidentiality?</t>

          <t>Does it need hop-by-hop authentication?</t>

          <t>Does it need hob-by-hop confidentiality?</t>

          <t></t>

          <t></t>
        </list></t>

      <t>Some general considerations apply. Fields that are end-to-end
      authenticated is actually recommended to be hop-by-hop authenticated,
      even when there only are a end-to-end version of the field. The reason
      for this is to detect modifications at the earliest instance and avoid
      wasting resource further down the path.</t>

      <section title="Version Field (V)">
        <t>As the solution is focused on RTP as defined by <xref
        target="RFC3550"></xref> this field must be 2. The field is not
        expected to be modified by an MDD. The receiving endpoint will also
        assume that the originating endpoint used RTP (V=2). Modification of
        this field should result in the packet being dropped by the receiving
        endpoint or MDD, independent if it is hop-by-hop authenticated. The
        version field does not require end-to-end authentication as the MDD
        has more efficient denial of service attacks that it can perform on
        the endpoints, including not forwarding a single media packet/stream.
        The field does not need to be confidentiality protected end-to-end as
        the MDD must know that it is RTP it receives. The field may be
        hop-by-hop confidentiality protected as part of an attempt to hide
        that the packet stream is RTP, although packet analysis is likely to
        reveal that the streams are real-time media anyway.</t>
      </section>

      <section title="Padding Indicator bit (P)">
        <t>The padding bit is an indicator for the presence of the padding
        octets at the end of the RTP payload. As further discussed in <xref
        target="sec-padding-octets">Padding Octets</xref> the padding is
        considered part of the payload and jointly protected with the payload.
        The reason for this is that padding can help hide length variations in
        the payload that can leak information about the media content being
        carried <xref target="RFC6562"></xref>.</t>

        <t>As the Payload and padding octets are end-to-end protected, the
        padding indicator can't be modified by the MDD, due to its inability
        to remove the padding octets. For correct processing in the receiving
        endpoint the padding indicator needs to be correct. Therefore it
        should be end-to-end authenticated. It could be end-to-end
        confidentiality protected. The benefit of protecting it end-to-end
        would be that the MDD would not know if the end-to-end payload is
        padded or not. Knowing if the payload is padded or not reduces the
        uncertainty for an attacker that attempts to perform content analysis
        based on payload length. Because of that it would beneficial to
        protect the padding bit also hop-by-hop, if not already protected
        end-to-end. The padding bit should be hop-by-hop authenticated to
        protect if end-to-end authentication is not used.</t>
      </section>

      <section title="Extension Indicator bit (X)">
        <t>The extension indicator bit indicates if the header extension part
        is present. The MDD will be the target recipient of some RTP header
        extensions. It can also remove the ones not necessary to reach the
        receiving endpoint. This can result that something starting out with
        header extensions may no longer have any on the last hop. Thus, the
        MDD must be able to modify the X bit. Currently, there is no strong
        argument for why a receiving endpoint needs to know that there where
        header extensions present from the originating endpoint that has been
        removed. It might arise if one starts using end-to-end confidentiality
        protected header extensions and want to ensure detection of removal of
        such header extensions by the MDD. However, other methods for ensuring
        that is likely to exist. Conclusion is that there are no need for
        knowing the original value.</t>

        <t>There are no need for end-to-end confidentiality, nor
        authentication. Hop-by-hop authentication shall be used to prevent
        unnecesary erronous processing of the packet. Hop-by-hop
        confidentiality is recommended but lack of it has very minor impact as
        the information leaked is the presence or not of header extensions.
        Having this knowledge may simplify payload length based attacks in
        regards to the content.</t>
      </section>

      <section title="CSRC Count (CC)">
        <t>Contributing Sources count indicates how many CSRC values that are
        part of the CSRC field and are critical to know to correctly find the
        start of the payload within the RTP packet. When using MDDs that
        follow the Media Switching RTP Mixer topology (Section 3.6.2 of <xref
        target="I-D.ietf-avtcore-rtp-topologies-update"></xref>) the MDD will
        need to insert the originating endpoint's SSRC as CSRC value in the
        outgoing stream when that stream contains a payload from the by the
        CSRC identified originating stream. This results that in the MDD can
        modify and add CSRC fields when performing switching. And in cases an
        MDD operating like a SFM (Section 3.7 of <xref
        target="I-D.ietf-avtcore-rtp-topologies-update"></xref>) receives a
        switched media stream it may attempt to restore the mixed stream into
        a number of SSRC specific streams, thus removing the CSRC field. An
        originating endpoint is unlikely to have a need to insert an CSRC,
        this as in PERC context it is expected that the media sources have a
        direct relation to the endpoint. The need for an endpoint to express
        that it generates a mixed or switched stream where it can generate
        "end-to-end" secured payload with such properties appear to be in a
        violation of the intended security model. The current conclusion will
        be no need for orignal value. <list style="empty">
            <t>Note: The possibility for originating endpoints to create a
            CSRC list will need further discussion as it affects the
            possibility to rely on the SSRC/CSRC value as reference to the
            originating identity.</t>
          </list>The CC field does not appear to need end-to-end
        authenticated, nor confidentiality protected. The CC field shall be
        hop-by-hop authenticated to prevent third party modifcations as it
        effects finding the payload limit. Errors here can only lead to
        wasting resources for further entities in the conference, and should
        be detected as early as possible. Erronous payload delimitation due to
        error in the CC field will result in the receiving endpoint's
        integrity verification of the end-to-end payload will fail. End-to-end
        confidentiality is recommened as the CC field allows a third party to
        better determine the RTP payload size, thus being information with
        some privacy sensitivity</t>

        <t></t>
      </section>

      <section title="Marker Bit (M)">
        <t>The marker bit semantics are dependent on the RTP payload format in
        use. Two dominant semantics are in use, but not limited to these two.
        Video primarily use it to indicate the last packet carrying part of an
        encoded video frame. Audio primarily use it to indicate the start of a
        talk spurt, indicating where an receiver could adjust its jitter
        buffer and playout.</t>

        <t>The MDD could depending on semantics potentially have an interest
        in setting the marker. One example could be an MDD that like to set an
        marker bit for audio to indicate the start of a media stream when
        swtiching in/on a particular originating endpoint's stream. In the
        discussion about this for PERC the conclusion is that an MDD can use
        other methods for indicating the switch in event. The main argument
        for this is to avoid having to understand the semantics of the payload
        currently present. Especially as codec switches can change the
        semantics in the middle of an ongoing conference session. The marker
        bit is meta data about the stream that can be relevant for knowing
        where appropriate switching points are, depending on the
        semantics.</t>

        <t>The receiving endpoint's need for original value from the
        originating endpoint is dependent on the semantics. However, for many
        semantics it is important for the originating value is know by the
        receiving endpoint. Therefore the recommendation is to require the
        originating value to be made available to the receiving endpoint.</t>

        <t>The recommendation is to use end-to-end authenticaiton of the
        value. End-to-end confidentiality needs exits as the marker bit can
        carry semantics direclty related to the content encoded. Audio's
        common semantics as start of speech burst, is telling the passive
        monitoring something on the ongoing flow of information. This needs to
        be balanced against the potential needs for the MDD to have this
        information for better function, like knowing where to switch.</t>

        <t>The marker bit should be both end-to-end authenticated as well as
        confidentiality protected. This is to prevent modification of this
        important piece of information to avoid that the MDD react to
        manipulated data. The confidentiality is there to prevent third
        parties from learning the information, potentially privacy
        sensitive.</t>
      </section>

      <section title="Payload Type (PT)">
        <t>The payload type identies the RTP payload format and thus normally
        the encoding of the media content in the payload. The dominant usage
        is to use some type of signalling protocol to agree on a mapping
        between a payload format and its parameters following the payload
        formats MIME type and the 7-bit field values. There exist some
        statically assigned codecs, but these values can still be assigned to
        other payload format configurations by the signalling.</t>

        <t>The MDD is expected to be required to rewrite the PT values when
        forwarding the payloads. The reason for this is that in many
        signalling contexts the binding between a payload type value and the
        payload format configuration will only have local meaning. And the PT
        value identifying a particular codec configuration is not unlikely a
        different value with another endpoint. Thus, the MDD will need to
        maintain translation tables for each ingress and egress pair. </t>

        <t>As knowing the correct payload format and codec configuration is
        cruical to be able to correctly decode the received payload, it is in
        the interest of the receiving endpoint to know the originating payload
        format and codec configuration. This would indicate a need to know the
        original value of the PT field. Unfortunately that is not sufficient
        to securly verify that no malicious changes has occurded on the path
        by a third party or the MDDs. The receiving endpoint would need to
        know also how the originating PT values map against the payload format
        and its parameters to verify correctness.</t>

        <t>End-to-end authentication of original value is recommended given
        that the receiving endpoint can also get the payload format
        configuration. End-to-end confidentiality could be desirable as it
        simplifies for an attacker to know which codec is used, or at least
        detect when the codec changes. When doing content analytics it
        simplifies to know the codec, so the codecs behaviour can be accounted
        for. However, this is not cruical information, and it appears very
        difficult to confidentiality protect the PT field value in respect to
        the MDD. </t>

        <t>Hop-by-hop authentication is important to prevent thrid-party
        modifications and avoid wasting resources by forwarding erronous
        information. Hob-by-hop confidentiality is recommended by not cruical
        as the information leakage can be limited to knowing when the same
        codec is being used. If the signalling is kept confidential towards
        any third party, then this minimal leakage is achieved. If one uses
        payload formats that has static mappings without remapping them, then
        the codec will be known by third parties. The payload type is needed
        in third party quality monitors that gather statitics about the RTP
        packet stream as it passes a measuring point. </t>
      </section>

      <section title="Sequence Number">
        <t>The MDD will need to modify the originating sequence number when it
        performs any switching or on/off operations on the RTP stream. This to
        ensure that the outgoing RTP stream has consistent sequence numbers
        with the number of packets actually sent, rather then how many that is
        being received at the ingress.</t>

        <t>The receiving endpoint likely need the originating sequence number
        or something semantically equivalent. The reasons for this is replay
        protection. If the receiving endpoint knows through an end-to-end
        authenticated way the sequence in which the payloads was originated,
        the receiver can prevent using payloads that are replays from previous
        points in the RTP stream. <list style="empty">
            <t>Note: Sequence number based replay is vunerable in a
            environment where the MDD can perform swithcing operations from an
            attack using delaying of packets, rathern than replaying them. Due
            to the switching operation the receiving endpoint will need to
            accept any sequence number that is greater than previously
            received, as it lacks knowledge about how many payloads the
            originating endpoint has sent in the time interval since the last
            payload was received. Thus an MDD can select to send any payload
            between the last forwarded and the latest received from the
            origin.</t>
          </list></t>

        <t>End-to-End authentication of the original payload seqence number is
        likely required. End-to-end confidentiality is not possible as the
        MDDs needs to know in which sequence the payloads where sent. Being
        able to re-order the payloads could help improving the confidentiality
        of the media content as analysis using randomly reordered packets
        would be significantly more difficult. However, due to the real-time
        properties, such actions are unlikely to be feasible. However, if any
        such deliberate reordering would be attempted, the original sequence
        number would need to be confidentiality protected. </t>

        <t>Hop-by-hop authentication of the sequence number is recommended to
        prevent attacks on the receiver buffer, including forcing the receiver
        to discard other packets. Hop-by-hop confidentiality is recommened but
        not required. This as the goal would be to attempt to hide the correct
        sequence, across unintentional or intentional reordering, and enable
        detection of lost packets. Such knowledge has some use in content
        analysis. At the same time having this information in the clear
        enables third party monitoiring. </t>
      </section>

      <section title="Timestamp">
        <t></t>
      </section>

      <section title="SSRC">
        <t></t>
      </section>

      <section title="CSRC List">
        <t></t>
      </section>

      <section title="Header Extension">
        <t></t>
      </section>

      <section title="Payload">
        <t></t>
      </section>

      <section anchor="sec-padding-octets" title="Padding Octets">
        <t></t>
      </section>
    </section>

    <section anchor="Summary" title="Summery">
      <t>The following table summarizes the information from the previous
      section.</t>

      <texttable anchor="summaryTable" title="Summary of Handling Required">
        <ttcol align="center">Data</ttcol>

        <ttcol align="center">MDD Mod</ttcol>

        <ttcol align="center">Orig Needed</ttcol>

        <ttcol align="center">E2E Auth</ttcol>

        <ttcol align="center">E2E Conf</ttcol>

        <ttcol align="center">HBH Auth</ttcol>

        <ttcol align="center">HBH Conf</ttcol>

        <c>V</c>

        <c>No</c>

        <!-- MDD Modify -->

        <c>No</c>

        <!-- Orig Needed-->

        <c>No</c>

        <!-- E2E Auth-->

        <c>No</c>

        <!-- E2E Conf-->

        <c>No</c>

        <!--HBH Auth -->

        <c>No</c>

        <!-- HBH Conf-->

        <c>P</c>

        <c>No</c>

        <!-- MDD Modify -->

        <c>No</c>

        <!-- Orig Needed-->

        <c>No</c>

        <!-- E2E Auth-->

        <c>No</c>

        <!-- E2E Conf-->

        <c>Yes</c>

        <!--HBH Auth -->

        <c>No</c>

        <!-- HBH Conf-->

        <c>X</c>

        <c>Yes</c>

        <!-- MDD Modify -->

        <c>No</c>

        <!-- Orig Needed-->

        <c>No</c>

        <!-- E2E Auth-->

        <c>No</c>

        <!-- E2E Conf-->

        <c>Yes</c>

        <!--HBH Auth -->

        <c>No</c>

        <!-- HBH Conf-->

        <c>CC</c>

        <c>Yes</c>

        <!-- MDD Modify -->

        <c>No</c>

        <!-- Orig Needed-->

        <c>No</c>

        <!-- E2E Auth-->

        <c>No</c>

        <!-- E2E Conf-->

        <c>Yes</c>

        <!--HBH Auth -->

        <c>No</c>

        <!-- HBH Conf-->

        <c>M</c>

        <c>?</c>

        <!-- MDD Modify -->

        <c>?</c>

        <!-- Orig Needed-->

        <c>?</c>

        <!-- E2E Auth-->

        <c>No</c>

        <!-- E2E Conf-->

        <c>Yes</c>

        <!--HBH Auth -->

        <c>No</c>

        <!-- HBH Conf-->

        <c>PT</c>

        <c>May</c>

        <!-- MDD Modify -->

        <c>?</c>

        <!-- Orig Needed-->

        <c>?</c>

        <!-- E2E Auth-->

        <c>No</c>

        <!-- E2E Conf-->

        <c>Yes</c>

        <!--HBH Auth -->

        <c>No</c>

        <!-- HBH Conf-->

        <c>Seq No</c>

        <c>May</c>

        <!-- MDD Modify -->

        <c>Yes</c>

        <!-- Orig Needed-->

        <c>Yes</c>

        <!-- E2E Auth-->

        <c>No</c>

        <!-- E2E Conf-->

        <c>Yes</c>

        <!--HBH Auth -->

        <c>No</c>

        <!-- HBH Conf-->

        <c>Timestamp</c>

        <c>May</c>

        <!-- MDD Modify -->

        <c>?</c>

        <!-- Orig Needed-->

        <c>?</c>

        <!-- E2E Auth-->

        <c>No</c>

        <!-- E2E Conf-->

        <c>Yes</c>

        <!--HBH Auth -->

        <c>No</c>

        <!-- HBH Conf-->

        <c>SSRC</c>

        <c>May</c>

        <!-- MDD Modify -->

        <c>Yes</c>

        <!-- Orig Needed-->

        <c>Yes</c>

        <!-- E2E Auth-->

        <c>No</c>

        <!-- E2E Conf-->

        <c>Yes</c>

        <!--HBH Auth -->

        <c>No</c>

        <!-- HBH Conf-->

        <c>CSRCs</c>

        <c>Yes</c>

        <!-- MDD Modify -->

        <c>No</c>

        <!-- Orig Needed-->

        <c>No</c>

        <!-- E2E Auth-->

        <c>No</c>

        <!-- E2E Conf-->

        <c>Yes</c>

        <!--HBH Auth -->

        <c>No</c>

        <!-- HBH Conf-->

        <c>Extensions</c>

        <c>Yes</c>

        <!-- MDD Modify -->

        <c>No</c>

        <!-- Orig Needed-->

        <c>No</c>

        <!-- E2E Auth-->

        <c>No</c>

        <!-- E2E Conf-->

        <c>Yes</c>

        <!--HBH Auth -->

        <c>Some</c>

        <!-- HBH Conf-->

        <c>Payload</c>

        <c>No</c>

        <!-- MDD Modify -->

        <c>Yes</c>

        <!-- Orig Needed-->

        <c>Yes</c>

        <!-- E2E Auth-->

        <c>Yes</c>

        <!-- E2E Conf-->

        <c>Yes</c>

        <!--HBH Auth -->

        <c>Yes</c>

        <!-- HBH Conf-->

        <c>Padding</c>

        <c>No</c>

        <!-- MDD Modify -->

        <c>Yes</c>

        <!-- Orig Needed-->

        <c>Yes</c>

        <!-- E2E Auth-->

        <c>Yes</c>

        <!-- E2E Conf-->

        <c>Yes</c>

        <!--HBH Auth -->

        <c>Yes</c>

        <!-- HBH Conf-->
      </texttable>
    </section>

    <section anchor="IANA" title="IANA Considerations">
      <t>This document makes no request of IANA.</t>

      <t>Note to RFC Editor: this section may be removed on publication as an
      RFC.</t>
    </section>

    <section anchor="Security" title="Security Considerations">
      <t>The purpose of this document include discussing the security issue
      around the information in the RTP header. That is covered above in the
      document. Worth noting is the differences in recommendation for
      hop-by-hop confidentiality compared to regular SRTP. </t>
    </section>

    <section title="Contributors">
      <t>Cullen Jennings contributed the summary table.</t>
    </section>

    <section anchor="Acknowledgements" title="Acknowledgements">
      <t></t>
    </section>
  </middle>

  <back>
    <references title="Normative References">
      <?rfc include="reference.RFC.2119"?>

      <?rfc include='reference.RFC.3550'?>

      <?rfc include='reference.RFC.6562'?>

      <?rfc include='reference.I-D.ietf-avtcore-rtp-topologies-update'?>
    </references>
  </back>
</rfc>
